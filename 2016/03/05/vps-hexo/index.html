<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="author" content="leobin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>在VPS上搭建hexo</title><link rel="stylesheet" type="text/css" href="//staticfile.qnssl.com/normalize/3.0.3/normalize.min.css"><link rel="stylesheet" type="text/css" href="/css/carbon.css"><!--script(defer='defer', src=theme.cdn.jQuery + '/jquery/2.1.4/jquery.min.js')--><!--script(defer='defer', src=theme.cdn.pjax + '/jquery.pjax/1.9.5/jquery.pjax.min.js')--><!--script(defer='defer', src=theme.cdn.carbon + '/js/carbon.js')--></head><body><div id="container"><div id="banner"><h1 id="site-title"><a href="/">Leobin's blog</a></h1><p id="site-subtitle"></p></div><div id="content"><div class="meta"><h2 class="article-title"><a href="/2016/03/05/vps-hexo/">在VPS上搭建hexo</a></h2><div class="article-date">2016-03-05</div></div><div class="extra"><span class="Tags">Tags: 無.</span></div><div class="extra"><span class="Categorias">Categorias: 無.</span></div><div class="article-content"><div class="gallery"></div><blockquote>
<p>在VPS上搭建有两种方案：<br>    1.在VPS上搭建完整的生产环境，使用Nginx反代VPS本地localhost实现访问。<br>    2.类似托管Github之上，仅需要Nginx作静态环境，本地生成静态文件后push。</p>
</blockquote>
<p>明显看得出来，第二种是最方便的，所以我选的是第二种，仅需nginx，意味着可以在很低配的机器上托管你的hexo了。下面就让我们开始吧。</p>
<hr>
<h2 id="1-_u672C_u5730_u642D_u5EFA"><a href="#1-_u672C_u5730_u642D_u5EFA" class="headerlink" title="1.本地搭建"></a>1.本地搭建</h2><p>实在懒得写，可以参考这个教程，写的很详细 <a href="http://www.isetsuna.com/hexo/install-config/" target="_blank" rel="external">http://www.isetsuna.com/hexo/install-config/</a></p>
<h2 id="2-VPS_u90E8_u7F72"><a href="#2-VPS_u90E8_u7F72" class="headerlink" title="2.VPS部署"></a>2.VPS部署</h2><p>我以自己的debian为例，centos的步骤大部分也差不多。</p>
<h3 id="2-1_u5B89_u88C5git_u548Cnginx"><a href="#2-1_u5B89_u88C5git_u548Cnginx" class="headerlink" title="2.1安装git和nginx"></a>2.1安装git和nginx</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get update &#38;&#38; apt-get upgrade -y&#10;apt-get install git-core -y&#10;apt-get install nginx -y</span><br></pre></td></tr></table></figure>
<h3 id="2-2_u65B0_u5EFAgit_u7528_u6237_u6DFB_u52A0sudo_u6743_u9650"><a href="#2-2_u65B0_u5EFAgit_u7528_u6237_u6DFB_u52A0sudo_u6743_u9650" class="headerlink" title="2.2新建git用户添加sudo权限"></a>2.2新建git用户添加sudo权限</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adduser git --ingroup sudo</span><br></pre></td></tr></table></figure>
<h3 id="2-3_u521B_u5EFAgit_u4ED3_u5E93_uFF0C_u5E76_u914D_u7F6Essh_u767B_u5F55"><a href="#2-3_u521B_u5EFAgit_u4ED3_u5E93_uFF0C_u5E76_u914D_u7F6Essh_u767B_u5F55" class="headerlink" title="2.3创建git仓库，并配置ssh登录"></a>2.3创建git仓库，并配置ssh登录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su git&#10;cd ~&#10;mkdir .ssh &#38;&#38; cd .ssh&#10;touch authorized_keys&#10;vi authorized_keys#&#22312;&#36825;&#20010;&#25991;&#20214;&#20013;&#31896;&#36148;&#36827;&#31532;&#19968;&#27493;&#30003;&#35831;&#30340;key&#65288;&#22312;id_rsa.pub&#25991;&#20214;&#20013;&#65289;&#10;cd ~ &#10;mkdir hexo.git &#38;&#38; cd hexo.git#&#36825;&#37324;&#20026;&#20102;&#22909;&#35760;&#35774;&#32622;&#20179;&#24211;&#21517;&#20026;hexo&#65292;&#20320;&#20063;&#21487;&#20197;&#33258;&#23450;&#20041;&#10;git init --bare</span><br></pre></td></tr></table></figure>
<p>完成后测试一下，如果在git bash中输入ssh git@VPS的IP地址,能够远程登录的话，则表示设置成功了。</p>
<h3 id="2-4_u521B_u5EFA_u7F51_u7AD9_u76EE_u5F55_u5E76_u8D4B_u4E88git_u5BF9_u7F51_u7AD9_u76EE_u5F55_u7684_u6240_u6709_u6743"><a href="#2-4_u521B_u5EFA_u7F51_u7AD9_u76EE_u5F55_u5E76_u8D4B_u4E88git_u5BF9_u7F51_u7AD9_u76EE_u5F55_u7684_u6240_u6709_u6743" class="headerlink" title="2.4创建网站目录并赋予git对网站目录的所有权"></a>2.4创建网站目录并赋予git对网站目录的所有权</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /var/www&#10;mkdir hexo&#10;sudo chmod 775 -R /var/www/hexo #&#36825;&#37324;&#22914;&#26524;&#25253;&#38169;&#30340;&#35805;&#23558;775&#25913;&#20026;777</span><br></pre></td></tr></table></figure>
<h3 id="2-5_u914D_u7F6Egit_hooks"><a href="#2-5_u914D_u7F6Egit_hooks" class="headerlink" title="2.5配置git hooks"></a>2.5配置git hooks</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su git&#10;cd /home/git/hexo.git/hooks&#10;touch post-receive&#10;vi post-receive</span><br></pre></td></tr></table></figure>
<p>复制进下面的脚本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash&#10;GIT_REPO=/home/git/hexo.git #git&#20179;&#24211;&#10;TMP_GIT_CLONE=/tmp/hexo&#10;PUBLIC_WWW=/var/www/hexo #&#32593;&#31449;&#30446;&#24405;&#10;rm -rf $&#123;TMP_GIT_CLONE&#125;&#10;git clone $GIT_REPO $TMP_GIT_CLONE&#10;rm -rf $&#123;PUBLIC_WWW&#125;/*&#10;cp -rf $&#123;TMP_GIT_CLONE&#125;/* $&#123;PUBLIC_WWW&#125;</span><br></pre></td></tr></table></figure></p>
<p>之后更改脚本权限<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x post-receive</span><br></pre></td></tr></table></figure></p>
<h3 id="u914D_u7F6ENginx"><a href="#u914D_u7F6ENginx" class="headerlink" title="配置Nginx"></a>配置Nginx</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/nginx/conf.d&#10;touch hexo.conf&#10;vim /etc/nginx/conf.d/hexo.conf</span><br></pre></td></tr></table></figure>
<p>插入如下代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server &#123;                                                                               &#10;    listen 80;                                                                                               &#10;    root /var/www/hexo;#&#36825;&#37324;&#21487;&#20197;&#25913;&#25104;&#20320;&#30340;&#32593;&#31449;&#30446;&#24405;&#22320;&#22336;&#65292;&#25105;&#23558;&#32593;&#31449;&#25918;&#22312;/var/www/hexo                                                        &#10;    server_name example.com;                                                 &#10;    access_log  /var/log/nginx/hexo_access.log;                                    &#10;    error_log   /var/log/nginx/hexo_error.log;                                            &#10;    location ~* ^.+\.(ico|gif|jpg|jpeg|png)$ &#123;                            &#10;            root /var/www/hexo;//&#36825;&#37324;&#21487;&#20197;&#25913;&#25104;&#20320;&#30340;&#32593;&#31449;&#30446;&#24405;&#22320;&#22336;&#65292;&#25105;&#23558;&#32593;&#31449;&#25918;&#22312;/var/www/hexo                            &#10;            access_log   off;                 &#10;            expires      1d;                            &#10;        &#125;                                                                              &#10;    location ~* ^.+\.(css|js|txt|xml|swf|wav)$ &#123;                                   &#10;        root /var/www/hexo;//&#36825;&#37324;&#21487;&#20197;&#25913;&#25104;&#20320;&#30340;&#32593;&#31449;&#30446;&#24405;&#22320;&#22336;&#65292;&#25105;&#23558;&#32593;&#31449;&#25918;&#22312;/var/www/hexo                                                        &#10;        access_log   off;                                                          &#10;        expires      10m;                                                          &#10;    &#125;                                                                              &#10;    location / &#123;                                                                   &#10;        root /var/www/hexo;//&#36825;&#37324;&#21487;&#20197;&#25913;&#25104;&#20320;&#30340;&#32593;&#31449;&#30446;&#24405;&#22320;&#22336;&#65292;&#25105;&#23558;&#32593;&#31449;&#25918;&#22312;/var/www/hexo                                                &#10;        if (-f $request_filename) &#123;                                            &#10;            rewrite ^/(.*)$  /$1 break;                                    &#10;        &#125;                                                                      &#10;    &#125;                                                                              &#10;&#125;</span><br></pre></td></tr></table></figure></p>
<p>重启Nginx<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service nginx restart</span><br></pre></td></tr></table></figure></p>
<p>##本机的最后配置<br>修改hexo的配置文件_config.yml,修改deploy选项<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deploy:&#10;  type: git&#10;  message: update&#10;  repo: git@VPS&#30340;ip&#22320;&#22336;&#25110;&#22495;&#21517;:git&#20179;&#24211;&#22320;&#22336;,master&#10;&#31034;&#20363;&#65306;&#10;deploy:&#10;      type: git&#10;      message: update&#10;      repo:git@192.234.35.236:hexo.git,master</span><br></pre></td></tr></table></figure></p>
<p>接着hexo g &amp;&amp; hexo d就可以啦~</p>
<h2 id="u6CE8_u610F"><a href="#u6CE8_u610F" class="headerlink" title="注意"></a>注意</h2><p>ssh git@ip这步被拒绝，是远程端口默认为22端口，而不是VPS的ssh真正端口</p>
<p>解决方法：在.ssh文件夹下（也就是生成公钥的文件夹）创建config文件，输入如下内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Host VPS&#30340;IP&#10;HostName VPS&#30340;IP&#10;User git&#10;Port SSH&#31471;&#21475;&#10;IdentityFile ~/.ssh/id_rsa</span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="u53C2_u8003_u5185_u5BB9"><a href="#u53C2_u8003_u5185_u5BB9" class="headerlink" title="参考内容"></a>参考内容</h2><p>1.<a href="http://www.tiktokings.com/2016/01/26/hexo/" target="_blank" rel="external">http://www.tiktokings.com/2016/01/26/hexo/</a><br>2.<a href="http://blog.gt520.com/vps/239.html" target="_blank" rel="external">http://blog.gt520.com/vps/239.html</a><br>3.<a href="https://dynamicer.com/how-to-deploy-hexo-blogs-with-git-hooks-on-vps/" target="_blank" rel="external">https://dynamicer.com/how-to-deploy-hexo-blogs-with-git-hooks-on-vps/</a></p>
</div><nav class="pagination"><a id="right-navigator" href="/2016/02/19/sim/">个人手机卡的选择方式</a></nav></div><nav id="footer"><ul id="footer-links"><li><a href="/about/">關於</a></li><li><a href="/archives/">所有文章</a></li><li><a href="/guys/">友鏈</a></li><li><a href="https://github.com/icylogic/carbon" class="out-site">Theme.Carbon</a></li><li><a href="https://github.com/hexojs/hexo" class="out-site">Hexo</a></li></ul><script src="/js/instantclick.min.js" data-no-instant></script>
<script data-no-instant>InstantClick.init();</script></nav></div></body></html>